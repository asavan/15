(function(n){function o(a){var b={};b.x=a.pageX||a.clientX;b.y=a.pageY||a.clientY;return b}function p(a){a.preventDefault();q=a.target.outerText;a=o(a.changedTouches[0]);l.push(a)}function r(a){a.preventDefault();var a=a.changedTouches,b=o(a[a.length-1]),d=l[0],a=b.x-d.x,b=b.y-d.y,a=30>Math.abs(a)+Math.abs(b)?g:Math.abs(a)>Math.abs(b)?0>a?h:i:0>b?j:k;c.bigGo(a,q)&&m();l=[]}function m(){for(var a=0,b;b=e.childNodes[a],16>a;a++)b.textContent=c.order[a],b.style.visibility=c.order[a]?"visible":"hidden";
if(c.isCompleted())e.style.backgroundColor="red",n.removeEventListener("keydown",s),e.removeEventListener("touchstart",p),e.removeEventListener("touchend",r)}var h="left",i="right",j="up",k="down",g="none",c={Move:{up:-4,left:-1,down:4,right:1},order:[],init:function(){for(var a=1;16>a;++a)c.order.push(a);c.shuffle(c.order);c.order.push(0);c.solvable(c.order)||c.swap(0,1)},shuffle:function(a){for(var b=a.length;0<b;){var d=Math.floor(Math.random()*b);b--;var c=a[b];a[b]=a[d];a[d]=c}return a},getElementIndex:function(a){for(var b=
0;16>b;++b)if(c.order[b]==a)return b;return-1},getIndexezFromIndex:function(a){var b={};b.x=a%4;b.y=Math.floor(a/4);return b},direction:function(a,b){var d=b.x-a.x,c=b.y-a.y;return 0<Math.abs(d)&&0<Math.abs(c)?g:0<Math.abs(d)?0>d?h:i:0>c?j:k},_doMagic:function(a,b,d){console.log("start swaping..."+d);a=Math.abs(b.x-a.x+b.y-a.y);for(b=0;b<a;++b)c.go(d===h?i:d===i?h:d===j?k:d===k?j:g)},bigGo:function(a,b){var d=c.getElementIndex(b),d=c.getIndexezFromIndex(d),e=c.getElementIndex(0),e=c.getIndexezFromIndex(e),
f=c.direction(d,e);return a===f&&f!==g?(c._doMagic(d,e,f),!0):!1},hole:15,isCompleted:function(){return!this.order.some(function(a,b){return 0<a&&a-1!==b})},_go:function(a){var b=this.hole+a;if(0>b||15<b)return console.log("not go 1 "+b),!1;if((a===c.Move.left||a===c.Move.right)&&Math.floor(this.hole/4)!==Math.floor(b/4))return console.log("not go 2 "+b),!1;this.swap(b,this.hole);this.hole=b;return!0},go:function(a){return!a||a===g?!1:this._go(this.Move[a])},swap:function(a,b){var c=this.order[a];
this.order[a]=this.order[b];this.order[b]=c},solvable:function(a){for(var b=0,c=1,e=a.length-1;c<e;c++)for(var f=c-1;0<=f;f--)a[f]>a[c]&&++b;return!(b%2)}};c.init();for(var l=[],q="",e=document.body.appendChild(document.createElement("div")),t=0;16>t;t++)e.appendChild(document.createElement("div"));var s=function(a){c.go({39:"left",37:"right",40:"up",38:"down"}[a.keyCode])&&m()};n.addEventListener("keydown",s);e.addEventListener("touchstart",p,!1);e.addEventListener("touchend",r,!1);m()})(window);
